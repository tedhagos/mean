<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 4. File IO</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Programming using the MEAN stack" /><link rel="up" href="index.html" title="Programming using the MEAN stack" /><link rel="prev" href="working_with_files.html" title="Chapter 3. Working with files" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. File IO</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="working_with_files.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="file_io"></a>Chapter 4. File IO</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="file_io.html#reading_a_file_from_a_web_app">4.1. Reading a File from a Web App</a></span></dt><dt><span class="section"><a href="file_io.html#synchronous_file_operation">4.2. Synchronous File Operation</a></span></dt><dt><span class="section"><a href="file_io.html#dealing_with_asynchrony">4.3. Dealing with Asynchrony</a></span></dt></dl></div><a id="filereadexample.js"></a><pre class="programlisting">const fs = require('fs'); <a id="CO1-1"></a><span><img src="images/callouts/1.png" alt="1" border="0" /></span>
const filename = 'index.html';

fs.readFile(filename,'utf-8', function(err, data){
  if(err) { <a id="CO1-2"></a><span><img src="images/callouts/2.png" alt="2" border="0" /></span>
    console.log(err.message);
  }
  else {
    console.log(data); <a id="CO1-3"></a><span><img src="images/callouts/3.png" alt="3" border="0" /></span>
  }
});</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Import the <code class="literal">fs</code> library into our app. Anything that requires file io is
contained in this module</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>If the call fails, <code class="literal">err</code> won’t be null. Lots of things can cause
the <code class="literal">readFile()</code> to fail e.g. if the file is not there, the OS ran out
of file handles etc. If err isn’t null, the <code class="literal">if</code> block will find it
<span class="emphasis"><em>truthy</em></span></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-3"><span><img src="images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>If the call succeeds, <code class="literal">err</code> will be null (falsy) and the contents
of the file would have been loaded into the second parameter of our
callback function</p></td></tr></table></div><p>If you ran the code listing above, you would seen  an error message
because the file <span class="emphasis"><em>index.html</em></span> does not exist yet. Create the html file
and save it on the same folder where <span class="emphasis"><em>FileReadExample.js</em></span> is located.</p><p><a id="app-listing"></a><strong>index.html. </strong>
</p><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;h1&gt;Hello World&lt;/h1&gt;
&lt;/html&gt;</pre><p>
</p><p>Run the code sample again. This time, the contents of <span class="emphasis"><em>index.html</em></span>
will be echoed to the screen.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reading_a_file_from_a_web_app"></a>4.1. Reading a File from a Web App</h2></div></div></div><p>Let’s use the file reading technique we learned in the last section
and apply it in a simple web app. The basic idea is as follows (1) The
user navigates to the root document or the home page (2) we will call a
function that will read an html file and (3) we will write the
contents of the html file into the <code class="literal">response</code> stream.</p><p><a id="app.js"></a><strong>app.js. </strong>
</p><pre class="programlisting">const http = require('http');
const fs = require('fs');

const port = process.env.PORT || 3000;

http.createServer(function(req, res){
  var url = req.url.toUpperCase();
  switch(url) {
    case "/":
      // were in the home page
      break;
    case "/ABOUT":
      // were in the about page
      break;
    default:
      // Good place to write a 404 response
  }
});</pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="synchronous_file_operation"></a>4.2. Synchronous File Operation</h2></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="images/1.png" alt="1" /></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="dealing_with_asynchrony"></a>4.3. Dealing with Asynchrony</h2></div></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="working_with_files.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. Working with files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>